{% extends "base.html" %}
{% load static %}

{% block header %}{% endblock %}
{% block footer %}{% endblock %}

{% block main_container %}

<style>
  /* ===== Profile Detail („Çπ„Éû„ÉõÊÉ≥ÂÆö 390x844) ===== */
  .page{
    min-height: 100vh;
    width: 100%;
    background: linear-gradient(180deg, #bfe0ff 0%, #eaf5ff 48%, #ffffff 100%);
    display: flex;
    justify-content: center;
    box-sizing: border-box;
  }
  .inner{
    width: min(390px, 100%);
    padding: 18px 16px 90px;
    box-sizing: border-box;
    position: relative;
  }

  /* ===== Top bar ===== */
  .topbar{
    display: grid;
    grid-template-columns: 1fr auto 1fr;
    align-items: center;
    gap: 8px;
    padding: 6px 2px 12px;
  }

  .back-btn{
    justify-self: start;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    height: 34px;
    padding: 0 14px;
    border-radius: 999px;
    background: #fff;
    color: #111;
    text-decoration: none;
    font-weight: 900;
    border: 2px solid rgba(0,0,0,0.55);
    box-shadow: 0 10px 16px rgba(0,0,0,0.14);
    -webkit-tap-highlight-color: transparent;
  }
  .back-btn:active{ transform: translateY(2px); }

  .top-title{
    justify-self: center;
    display: inline-flex;
    align-items: center;
    gap: 10px;
    font-size: 22px;
    font-weight: 900;
    color: #111;
    letter-spacing: 0.02em;
    white-space: nowrap;
  }

  .edit-link{
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 34px;
    height: 34px;
    border-radius: 12px;
    text-decoration: none;
    color: #111;
    font-size: 18px;
    font-weight: 900;
    -webkit-tap-highlight-color: transparent;
  }
  .edit-link:hover{ background: rgba(255,255,255,0.55); }

  .hamburger{
    justify-self: end;
    width: 54px;
    height: 46px;
    border-radius: 14px;
    background: transparent;
    border: 0;
    cursor: pointer;
    display: grid;
    place-items: center;
    -webkit-tap-highlight-color: transparent;
  }
  .hamburger-lines{
    width: 34px;
    height: 22px;
    position: relative;
  }
  .hamburger-lines span{
    position: absolute;
    left: 0;
    right: 0;
    height: 4px;
    border-radius: 999px;
    background: #111;
  }
  .hamburger-lines span:nth-child(1){ top: 0; }
  .hamburger-lines span:nth-child(2){ top: 9px; }
  .hamburger-lines span:nth-child(3){ bottom: 0; }

  /* ===== Profile header ===== */
  .profile-head{
    margin-top: 8px;
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    gap: 10px;
  }

  .avatar{
    width: 140px;
    height: 140px;
    border-radius: 999px;
    background: #d9d9d9;
    border: 2px solid rgba(0,0,0,0.18);
    overflow: hidden;
    box-shadow: 0 14px 22px rgba(0,0,0,0.12);
  }
  .avatar img{
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }

  .username{
    margin-top: 2px;
    font-size: 18px;
    font-weight: 900;
    color: #111;
  }

  .bio{
    width: 100%;
    max-width: 360px;
    font-size: 13px;
    font-weight: 800;
    color: rgba(0,0,0,0.72);
    line-height: 1.6;
    display: flex;
    justify-content: center;
    word-break: break-word;
    text-align: left;
    padding: 0 6px;
  }

  /* ===== Follow / counts pill ===== */
  .pill-row{
    margin-top: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    flex-wrap: wrap;
  }

  .count-pill{
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-width: 220px;
    height: 42px;
    padding: 0 18px;
    border-radius: 999px;
    background: rgba(255,255,255,0.92);
    border: 2px solid rgba(0,0,0,0.22);
    box-shadow: 0 12px 18px rgba(0,0,0,0.12);
    text-decoration: none;
    color: #111;
    font-weight: 900;
    gap: 10px;
    -webkit-tap-highlight-color: transparent;
  }
  .count-pill:active{ transform: translateY(2px); }

  .count-pill span{
    font-size: 14px;
  }

  .follow-btn{
    display: inline-flex;
    align-items: center;
    justify-content: center;
    height: 42px;
    padding: 0 18px;
    border-radius: 999px;
    background: #fff;
    border: 2px solid rgba(0,0,0,0.22);
    box-shadow: 0 12px 18px rgba(0,0,0,0.12);
    font-weight: 900;
    cursor: pointer;
    -webkit-tap-highlight-color: transparent;
  }
  .follow-btn:active{ transform: translateY(2px); }

  /* ===== Posts list ===== */
  .posts{
    margin-top: 18px;
    display: flex;
    flex-direction: column;
    gap: 14px;
  }

  .post-card{
    position: relative;
    background: rgba(255,255,255,0.92);
    border: 2px solid rgba(0,0,0,0.18);
    border-radius: 18px;
    padding: 14px 14px 14px;
    box-shadow: 0 10px 18px rgba(0,0,0,0.10);
    overflow: hidden;
  }

  .post-link{
    display: block;
    text-decoration: none;
    color: inherit;
    -webkit-tap-highlight-color: transparent;
  }

  .post-title{
    font-size: 16px;
    font-weight: 900;
    color: #111;
    line-height: 1.2;
    margin-right: 44px; /* Âè≥‰∏ä„ÅÆ‚úé„Çπ„Éö„Éº„ÇπÁ¢∫‰øù */
  }

  .post-meta{
    margin-top: 6px;
    font-size: 12px;
    font-weight: 800;
    color: rgba(0,0,0,0.45);
  }

  .post-snippet{
    margin-top: 10px;
    font-size: 13px;
    font-weight: 800;
    color: rgba(0,0,0,0.75);
    line-height: 1.6;

    overflow: hidden;
    display: -webkit-box;
    -webkit-box-orient: vertical;
    -webkit-line-clamp: 3; /* 3Ë°å„ÅßÁúÅÁï• */
  }

  .post-empty{
    background: rgba(255,255,255,0.92);
    border: 2px solid rgba(0,0,0,0.18);
    border-radius: 18px;
    padding: 18px 14px;
    box-shadow: 0 10px 18px rgba(0,0,0,0.10);
    text-align: center;
    font-weight: 900;
    color: rgba(0,0,0,0.75);
  }

  .post-edit-mini{
    position: absolute;
    right: 10px;
    top: 10px;
    width: 34px;
    height: 34px;
    border-radius: 12px;
    display: grid;
    place-items: center;
    text-decoration: none;
    color: rgba(0,0,0,0.75);
    font-size: 18px;
    font-weight: 900;
    -webkit-tap-highlight-color: transparent;
    background: rgba(255,255,255,0.6);
  }
  .post-edit-mini:hover{ background: rgba(0,0,0,0.04); }

  /* ===== Drawer ===== */
  .overlay{
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.18);
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.16s ease;
  }
  .drawer{
    position: fixed;
    top: 0;
    right: 0;
    height: 100vh;
    width: min(320px, 86vw);
    background: linear-gradient(180deg, #bfe0ff 0%, #eaf5ff 48%, #ffffff 100%);
    transform: translateX(102%);
    transition: transform 0.18s ease;
    box-shadow: -18px 0 30px rgba(0,0,0,0.18);
    padding: 18px 16px;
    box-sizing: border-box;
  }
  .drawer.open{ transform: translateX(0); }
  .overlay.open{
    opacity: 1;
    pointer-events: auto;
  }

  .drawer-top{
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    padding: 4px 0 10px;
  }
  .drawer-title{
    font-size: 22px;
    font-weight: 900;
    color: #111;
  }
  .drawer-close{
    position: absolute;
    right: 2px;
    top: 0;
    width: 44px;
    height: 44px;
    border-radius: 14px;
    border: 0;
    background: transparent;
    font-size: 28px;
    font-weight: 900;
    cursor: pointer;
    -webkit-tap-highlight-color: transparent;
  }

  .drawer-profile{
    display: flex;
    align-items: center;
    gap: 12px;
    margin: 10px 0 18px;
    justify-content: center;
  }
  .drawer-avatar{
    width: 54px;
    height: 54px;
    border-radius: 999px;
    background: #d9d9d9;
    border: 2px solid rgba(0,0,0,0.12);
    overflow: hidden;
  }
  .drawer-avatar img{
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }
  .drawer-name{
    font-size: 18px;
    font-weight: 900;
    color: #111;
    font-style: italic;
  }

  .menu{
    margin-top: 8px;
    display: flex;
    flex-direction: column;
    gap: 14px;
    padding-left: 12px;
  }
  .menu a, .menu button{
    display: inline-flex;
    align-items: center;
    gap: 12px;
    font-size: 18px;
    font-weight: 900;
    color: #111;
    text-decoration: none;
    border: 0;
    background: transparent;
    cursor: pointer;
    padding: 10px 8px;
    border-radius: 14px;
    -webkit-tap-highlight-color: transparent;
  }
  .menu a:hover, .menu button:hover{
    background: rgba(255,255,255,0.55);
  }
  .icon{
    width: 26px;
    text-align: center;
    font-size: 22px;
  }

  /* base „ÅÆ‰ΩôÁôΩ„ÇíÊ∂à„Åô‰øùÈô∫ */
  .site-main, .container{ padding: 0 !important; margin: 0 !important; }
</style>

<div class="page">
  <div class="inner">

    <!-- ===== Top bar ===== -->
    <div class="topbar">
      <a class="back-btn" href="{% url 'post_list' %}">Êàª„Çã</a>

      <div class="top-title">
        „Éó„É≠„Éï„Ç£„Éº„É´
        {% if request.user.is_authenticated and request.user == user_obj %}
          <a class="edit-link" href="{% url 'profile:edit' %}" aria-label="„Éó„É≠„Éï„Ç£„Éº„É´Á∑®ÈõÜ">‚úé</a>
        {% endif %}
      </div>

      <button type="button" class="hamburger" id="openDrawer" aria-label="„É°„Éã„É•„Éº„ÇíÈñã„Åè">
        <div class="hamburger-lines" aria-hidden="true">
          <span></span><span></span><span></span>
        </div>
      </button>
    </div>

    <!-- ===== Profile header ===== -->
    <div class="profile-head">
      <div class="avatar" aria-label="„Ç¢„Ç§„Ç≥„É≥">
        {% if profile.icon %}
          <img src="{{ profile.icon.url }}" alt="icon">
        {% else %}
          <img src="{% static 'images/default_icon.png' %}" alt="icon">
        {% endif %}
      </div>

      <div class="username">{{ user_obj.username }}</div>

      <div class="bio">
        {% if profile.bio %}
          {{ profile.bio|linebreaksbr }}
        {% else %}
          Êú™Ë®≠ÂÆö
        {% endif %}
      </div>

      <div class="pill-row">
        <a class="count-pill" href="{% url 'follow:followers' user_obj.username %}">
          <span>„Éï„Ç©„É≠„ÉØ„Éº {{ followers_count }}</span>
          <span>l</span>
          <span>„Éï„Ç©„É≠„Éº‰∏≠ {{ following_count }}</span>
        </a>

        {% if request.user.is_authenticated and request.user != user_obj %}
          <form method="post" action="{% url 'follow:toggle' user_obj.username %}" style="margin:0;">
            {% csrf_token %}
            <button type="submit" class="follow-btn">
              {% if is_following %}„Éï„Ç©„É≠„ÉºËß£Èô§{% else %}„Éï„Ç©„É≠„Éº{% endif %}
            </button>
          </form>
        {% endif %}
      </div>
    </div>

    <!-- ===== Posts ===== -->
    <div class="posts">
      {% if posts %}
        {% for post in posts %}
          <div class="post-card">

            {% if request.user.is_authenticated and request.user == user_obj %}
              <a class="post-edit-mini" href="{% url 'post_edit' post.id %}" aria-label="ÊäïÁ®ø„ÇíÁ∑®ÈõÜ">‚úé</a>
            {% endif %}

            <a class="post-link" href="{% url 'post_detail' post.id %}">
              <div class="post-title">{{ post.title }}</div>

              <div class="post-meta">
                {{ post.created_at|date:"Y/m/d H:i" }} Ôºè {{ post.duration }}ÂàÜ
              </div>

              {% if post.content %}
                <div class="post-snippet">{{ post.content }}</div>
              {% endif %}
            </a>

          </div>
        {% endfor %}
      {% else %}
        <div class="post-empty">„Åæ„Å†ÊäïÁ®ø„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì</div>
      {% endif %}
    </div>

  </div>
</div>

<!-- ===== Drawer + Overlay ===== -->
<div class="overlay" id="overlay"></div>

<aside class="drawer" id="drawer" aria-label="Ë®≠ÂÆö„É°„Éã„É•„Éº">
  <div class="drawer-top">
    <div class="drawer-title">Ë®≠ÂÆö</div>
    <button type="button" class="drawer-close" id="closeDrawer" aria-label="Èñâ„Åò„Çã">√ó</button>
  </div>

  <div class="drawer-profile">
    <div class="drawer-avatar" aria-hidden="true">
      {% if request.user.is_authenticated and request.user.profile.icon %}
        <img src="{{ request.user.profile.icon.url }}" alt="icon">
      {% endif %}
    </div>
    <div class="drawer-name">
      {% if request.user.is_authenticated %}
        {{ request.user.username }}
      {% else %}
        guest
      {% endif %}
    </div>
  </div>

  <div class="menu">
    <a href="{% url 'post_list' %}">
      <span class="icon">üè†</span>
      <span>„Éõ„Éº„É†</span>
    </a>

    {% if request.user.is_authenticated %}
      <a href="{% url 'profile:detail' request.user.username %}">
        <span class="icon">üë§</span>
        <span>„É¶„Éº„Ç∂„ÉºË®≠ÂÆö</span>
      </a>
    {% else %}
      <a href="{% url 'login' %}">
        <span class="icon">üë§</span>
        <span>„É≠„Ç∞„Ç§„É≥</span>
      </a>
    {% endif %}

    <a href="javascript:void(0)" onclick="alert('ÈÄöÁü•Ë®≠ÂÆö„ÅØÊú™Êé•Á∂ö„Åß„Åô');">
      <span class="icon">üîî</span>
      <span>ÈÄöÁü•Ë®≠ÂÆö</span>
    </a>

    {% if request.user.is_authenticated %}
      <form method="post" action="{% url 'logout' %}" style="margin:0;">
        {% csrf_token %}
        <button type="submit">
          <span class="icon">üö™</span>
          <span>„É≠„Ç∞„Ç¢„Ç¶„Éà</span>
        </button>
      </form>
    {% endif %}
  </div>
</aside>

<script>
  // ===== Drawer open/close =====
  (function(){
    const openBtn = document.getElementById('openDrawer');
    const closeBtn = document.getElementById('closeDrawer');
    const overlay = document.getElementById('overlay');
    const drawer = document.getElementById('drawer');

    function open(){
      overlay.classList.add('open');
      drawer.classList.add('open');
    }
    function close(){
      overlay.classList.remove('open');
      drawer.classList.remove('open');
    }

    openBtn?.addEventListener('click', open);
    closeBtn?.addEventListener('click', close);
    overlay?.addEventListener('click', close);

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') close();
    });
  })();
</script>

{% endblock %}
